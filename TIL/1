import { DateTime } from 'luxon';

// Mock ë„ì‹œ ëª©ë¡
const cities = [
  { name: 'Seoul', timezone: 'Asia/Seoul' },
  { name: 'New York', timezone: 'America/New_York' },
  { name: 'Paris', timezone: 'Europe/Paris' },
  { name: 'London', timezone: 'Europe/London' },
  { name: 'Tokyo', timezone: 'Asia/Tokyo' },
  { name: 'Sydney', timezone: 'Australia/Sydney' },
  { name: 'Dubai', timezone: 'Asia/Dubai' },
  { name: 'Cairo', timezone: 'Africa/Cairo' },
];

// ëª¨í‚¹ëœ ë‚ ì”¨ API (7ì¼ì¹˜)
const getWeatherData = async (cityName) => {
  return new Promise((resolve) => {
    const data = Array.from({ length: 7 }).map(() => ({
      temp: Math.floor(Math.random() * 25 + 5), // 5ë„~30ë„ ëœë¤
    }));
    setTimeout(() => resolve(data), 100); // mock latency
  });
};

// ì—¬í–‰ ì¶”ì²œ í…ìŠ¤íŠ¸
const getTravelSuggestion = (city, tempDiff) => {
  if (tempDiff > 10) return `${city}ëŠ” ë‚ ì”¨ ë³€í™”ê°€ ê·¹ì‹¬í•´ì„œ ë‹¤ì–‘í•œ ê³„ì ˆ ì˜·ì´ í•„ìš”í•´ìš”. ëª¨í—˜ê°€ì—ê²Œ ì¶”ì²œ!`;
  if (tempDiff > 5) return `${city}ëŠ” ì„ ì„ í•˜ë©´ì„œë„ ê°„ê°„íˆ ë”ì›Œì„œ ì‚°ì±…ê³¼ ê´€ê´‘ ë‘˜ ë‹¤ ì¦ê¸°ê¸° ì¢‹ì•„ìš”.`;
  return `${city}ëŠ” ë‚ ì”¨ê°€ ì•ˆì •ì ì´ë¼ íœ´ì–‘ì— ì í•©í•©ë‹ˆë‹¤.`;
};

// ë©”ì¸ ë¡œì§
const findTopTravelCities = async () => {
  try {
    const currentDate = DateTime.now();

    // 1. ë°¤ì¸ ë„ì‹œ í•„í„°ë§
    const nightCities = cities.filter((city) => {
      const localTime = currentDate.setZone(city.timezone);
      const hour = localTime.hour;
      return hour >= 20 || hour <= 6;
    });

    console.log('ë°¤ì¸ ë„ì‹œ:', nightCities.map((c) => c.name));

    // 2. ë‚ ì”¨ ë³€í™”ëŸ‰ ê³„ì‚°
    const weatherChanges = await Promise.all(
      nightCities.map(async (city) => {
        const weather = await getWeatherData(city.name); // 7ì¼ì¹˜ ë‚ ì”¨
        const temps = weather.map((w) => w.temp);
        const max = Math.max(...temps);
        const min = Math.min(...temps);
        return {
          city: city.name,
          tempDiff: max - min,
        };
      })
    );

    // 3. ë³€í™”ëŸ‰ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬ ë° ìƒìœ„ 5ê°œ ì¶”ì¶œ
    const topCities = weatherChanges
      .sort((a, b) => b.tempDiff - a.tempDiff)
      .slice(0, 5);

    // 4. ê²°ê³¼ ì¶œë ¥
    console.log('\nğŸ“ ì¶”ì²œ ì—¬í–‰ì§€ TOP 5');
    topCities.forEach(({ city, tempDiff }, index) => {
      const reason = getTravelSuggestion(city, tempDiff);
      console.log(`${index + 1}. ${city} - ë³€í™”ëŸ‰: ${tempDiff}ë„ ğŸŒ¡ï¸ â†’ ${reason}`);
    });

  } catch (err) {
    console.error('ì—ëŸ¬ ë°œìƒ:', err);
  }
};

// ì‹¤í–‰
findTopTravelCities();
