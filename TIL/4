// ğŸ“ procedural-city-generator.js

/**
 * ì£¼ì œ: ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ ì ˆì°¨ì  ë„ì‹œ ìƒì„±ê¸° ë§Œë“¤ê¸° (500ì¤„ ì§€ë¦¬ëŠ” ì½”ë“œ)
 * ì„¤ëª…: ë„ë¡œ, ê±´ë¬¼, êµ¬ì—­ì„ ìë™ ìƒì„±í•˜ê³  ì‹œê°í™” ì—†ì´ ì½˜ì†” ê¸°ë°˜ ì¶œë ¥
 */

// ------------------------
// SECTION 1: ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
// ------------------------
function randomInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}

function randomChoice(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function pad(str, len) {
  return str + ' '.repeat(Math.max(0, len - str.length));
}

// ------------------------
// SECTION 2: ë„ë¡œ ë° ê±´ë¬¼ ì •ì˜
// ------------------------
class Road {
  constructor(id, orientation, position) {
    this.id = id;
    this.orientation = orientation; // 'horizontal' or 'vertical'
    this.position = position; // grid ìƒ ì¢Œí‘œ (x ë˜ëŠ” y)
  }
}

class Building {
  constructor(id, type, height, area, blockX, blockY) {
    this.id = id;
    this.type = type; // 'residential', 'commercial', 'industrial'
    this.height = height;
    this.area = area;
    this.blockX = blockX;
    this.blockY = blockY;
  }

  summary() {
    return `ğŸ¢ ${this.type.toUpperCase()} | ${this.area}ã¡ | ${this.height}ì¸µ`;
  }
}

// ------------------------
// SECTION 3: CityGenerator
// ------------------------
class CityGenerator {
  constructor(width, height) {
    this.width = width;
    this.height = height;
    this.roads = [];
    this.buildings = [];
    this.blocks = new Map(); // key: "x,y", value: [Building]
  }

  generateRoads() {
    let roadId = 1;
    for (let x = 0; x <= this.width; x += randomInt(3, 5)) {
      this.roads.push(new Road(roadId++, 'vertical', x));
    }
    for (let y = 0; y <= this.height; y += randomInt(3, 5)) {
      this.roads.push(new Road(roadId++, 'horizontal', y));
    }
  }

  generateBuildings() {
    const types = ['residential', 'commercial', 'industrial'];
    let id = 1;
    for (let x = 0; x < this.width; x++) {
      for (let y = 0; y < this.height; y++) {
        if (this.isRoad(x, y)) continue; // ë„ë¡œ ìœ„ì¹˜ì—” ê±´ë¬¼ ì—†ìŒ

        const type = randomChoice(types);
        const height = randomInt(1, 10);
        const area = randomInt(50, 300);
        const b = new Building(id++, type, height, area, x, y);

        const key = `${x},${y}`;
        if (!this.blocks.has(key)) this.blocks.set(key, []);
        this.blocks.get(key).push(b);
        this.buildings.push(b);
      }
    }
  }

  isRoad(x, y) {
    const isXRoad = this.roads.some((r) => r.orientation === 'vertical' && r.position === x);
    const isYRoad = this.roads.some((r) => r.orientation === 'horizontal' && r.position === y);
    return isXRoad || isYRoad;
  }

  printMap() {
    for (let y = 0; y < this.height; y++) {
      let row = '';
      for (let x = 0; x < this.width; x++) {
        if (this.isRoad(x, y)) {
          row += 'â•';
        } else {
          const key = `${x},${y}`;
          const b = this.blocks.get(key);
          if (!b || b.length === 0) row += 'Â·';
          else {
            const type = b[0].type;
            row += type === 'residential' ? 'R' : type === 'commercial' ? 'C' : 'I';
          }
        }
      }
      console.log(row);
    }
  }

  printStats() {
    const total = this.buildings.length;
    const types = this.buildings.reduce((acc, b) => {
      acc[b.type] = (acc[b.type] || 0) + 1;
      return acc;
    }, {});

    console.log(`\nğŸ™ï¸ ë„ì‹œ í†µê³„:`);
    console.log(`ì „ì²´ ê±´ë¬¼ ìˆ˜: ${total}`);
    for (const t in types) {
      console.log(`- ${t}: ${types[t]}ì±„`);
    }
  }

  printSampleBuildings(limit = 10) {
    console.log(`\nğŸ“‹ ëŒ€í‘œ ê±´ë¬¼:`);
    this.buildings.slice(0, limit).forEach((b) => {
      console.log(`[${b.id}] ${b.summary()}`);
    });
  }
}

// ------------------------
// SECTION 4: ì‹¤í–‰ë¶€
// ------------------------
(function runCitySimulation() {
  console.log("ğŸ§  ì ˆì°¨ì  ë„ì‹œ ìƒì„± ì¤‘...");
  const city = new CityGenerator(40, 20); // 40x20 ê·¸ë¦¬ë“œ
  city.generateRoads();
  city.generateBuildings();
  city.printMap();
  city.printStats();
  city.printSampleBuildings(15);
})();
